var W=Object.defineProperty;var D=(s,e,t)=>e in s?W(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var h=(s,e,t)=>(D(s,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();var E=class{constructor(s){h(this,"_$dlNodeType");h(this,"_$parentEl");h(this,"_$nodes");this._$dlNodeType=s}get _$el(){return E.toEls(this._$nodes)}static toEls(s){let e=[];return this.loopShallowEls(s,t=>{e.push(t)}),e}static loopDLNodes(s,e){s.forEach(t=>{e(t),t._$nodes&&E.loopDLNodes(t._$nodes,e)})}static loopDLNodesInsideOut(s,e){s.forEach(t=>{t._$nodes&&E.loopDLNodesInsideOut(t._$nodes,e),e(t)})}static loopShallowEls(s,e){s.forEach(t=>{if(!("_$dlNodeType"in t))return e(t);t._$nodes&&E.loopShallowEls(t._$nodes,e)})}static loopShallowDLNodes(s,e){s.forEach(t=>{"_$dlNodeType"in t&&(e(t),t._$nodes&&E.loopShallowDLNodes(t._$nodes,e))})}static addParentEl(s,e){this.loopShallowDLNodes(s,t=>{t._$parentEl=e})}static getFlowIndexFromNodes(s,e){let t=0,i=[...s];for(;i.length>0;){let n=i.shift();if(n===e)break;"_$dlNodeType"in n?n._$nodes&&i.unshift(...n._$nodes):t++}return t}static appendNodesWithSibling(s,e,t){return t?this.insertNodesBefore(s,e,t):this.appendNodes(s,e)}static appendNodesWithIndex(s,e,t,i){return i=i??e.childNodes.length,i!==t?this.insertNodesBefore(s,e,e.childNodes[t]):this.appendNodes(s,e)}static insertNodesBefore(s,e,t){let i=0;return this.loopShallowEls(s,n=>{e.insertBefore(n,t),i++}),i}static appendNodes(s,e){let t=0;return this.loopShallowEls(s,i=>{e.appendChild(i),t++}),t}static willUnmountFunc(s,e){s(),e==null||e()}static addWillUnmount(s,e){s.willUnmount=this.willUnmountFunc.bind(this,e,s.willUnmount)}};function U(s,e){Object.entries(e).forEach(([t,i])=>{s.style[t]=i})}function H(s,e){Object.entries(e).forEach(([t,i])=>{s.dataset[t]=i})}function N(s,e,t){let i=`$${e}`;i in s&&s[i]===t||(s[e]=t,s[i]=t)}function j(s,e){Object.entries(e).forEach(([t,i])=>{N(s,t,i)})}function k(s,e,t){let i=`$${e}`;i in s&&s[i]===t||(s.setAttribute(e,t),s[i]=t)}function A(s,e){Object.entries(e).forEach(([t,i])=>{k(s,t,i)})}function C(s,e,t){let i=s[`$on${e}`];i&&s.removeEventListener(e,i),s.addEventListener(e,t),s[`$on${e}`]=t}function I(s){let e=document.createElement("template");e.innerHTML=s;let t=e.content.firstChild;return()=>t.cloneNode(!0)}function O(s){return document.createElement(s)}function T(s,e,t){s._$nodes||(s._$nodes=Array.from(s.childNodes)),s._$nodes.splice(t,0,e),E.appendNodesWithIndex([e],s,t),E.addParentEl([e],s)}function M(s,e,t){if(e==="style"){U(s,t);return}if(e==="dataset"){H(s,t);return}if(e!=="element"){if(e==="prop"){j(s,t);return}if(e==="attr"){A(s,t);return}if(e==="innerHTML"){N(s,"innerHTML",t);return}if(e!=="forwardProp"){if(e.startsWith("on")){C(s,e.slice(2).toLowerCase(),t);return}k(s,e,t)}}}var B=class extends E{constructor(){super(0)}_$init(s,e,t,i){var n,o,u;i&&i._$addForwardProps(this),e!==null&&this._$setContent(e),s&&Object.entries(s).forEach(([f,c])=>{this._$setProp(f,c)}),t&&(this._$children=t),Object.entries(window.DLEnvStore.envs).forEach(([f,[c,a]])=>{a.addNode(this),this._$initEnv(f,c,a)}),this._$callUpdatesBeforeInit(),(n=this.willMount)==null||n.call(this),this._$nodes=((o=this.View)==null?void 0:o.call(this))??[],(u=this.didMount)==null||u.call(this)}_$callUpdatesBeforeInit(){let s=Object.getOwnPropertyNames(Object.getPrototypeOf(this)),e=Object.getOwnPropertyNames(this);[...s,...e].forEach(t=>{if(t.startsWith("$w$"))return this[t.slice(3)]();t.startsWith("$f$")&&(this[`$${t.slice(3)}`]=this[t])})}_$setForwardProp(s,e){if(s in this){this[s]=e;return}this._$forwardPropsId.push(s);let t=`$${s}`;this[t]=e,Object.defineProperty(this,s,{get(){return this[t]},set(i){var n;this[t]!==i&&(this[t]=i,(n=this._$forwardPropsSet)==null||n.forEach(o=>{o._$dlNodeType===0&&o._$setProp(s,i),o instanceof HTMLElement&&M(o,s,i)}))}})}_$addForwardProps(s){this._$forwardPropsSet.add(s),this._$forwardPropsId.forEach(e=>{var i;let t=this[e];(i=this._$forwardPropsSet)==null||i.forEach(n=>{n._$dlNodeType===0&&("_$forwardProps"in n&&n._$forwardPropsId.push(e),n._$setProp(e,t)),n instanceof HTMLElement&&M(n,e,t)})}),E.addWillUnmount(s,this._$forwardPropsSet.delete.bind(this._$forwardPropsSet,s))}_$setProp(s,e){"_$forwardProps"in this&&this._$setForwardProp(s,e),`$p$${s}`in this&&(this[s]=e)}_$initEnv(s,e,t){`$e$${s}`in this&&(this[s]=e,this[`$en$${s}`]=t)}_$updateEnv(s,e,t){`$e$${s}`in this&&t===this[`$en$${s}`]&&this[s]!==e&&(this[s]=e)}_$setContent(s){let e=this._$contentKey;e&&this[e]!==s&&(this[e]=s)}_$updateProp(s,e){let t=`$${s}`;this[t]!==e&&(this[t]=e,this._$updateDerived(s),this._$updateView(s))}_$updateDerived(s){var e;this._$nodes&&((e=this[`$s$${s}`])==null||e.forEach(t=>{`$w$${t}`in this?this[t]():this[`$${t}`]=this[`$f$${t}`]}))}_$updateView(s){var t;let e=this[`$$${s}`];e&&((t=this._$update)==null||t.call(this,e))}},K=B,w=class extends E{constructor(s){super(s),window.DLEnvStore.currentEnvNodes.length>0&&(this.savedEnvNodes=[...window.DLEnvStore.currentEnvNodes])}initNewNodes(s){E.addParentEl(s,this._$parentEl)}geneNewNodesInEnv(s){if(!this.savedEnvNodes){let i=s();return this.initNewNodes(i),i}let e=window.DLEnvStore.currentEnvNodes;window.DLEnvStore.replaceEnvNodes(this.savedEnvNodes);let t=s();return window.DLEnvStore.replaceEnvNodes(e),this.initNewNodes(t),t}removeNodes(s){E.loopDLNodes(s,e=>{var t;return(t=e.willUnmount)==null?void 0:t.call(e)}),E.loopShallowEls(s,e=>{var t;(t=this._$parentEl)==null||t.removeChild(e)}),E.loopDLNodesInsideOut(s,e=>{var t;return(t=e.didUnmount)==null?void 0:t.call(e)})}},P=class extends w{constructor(e,t,i,n){super(1);h(this,"array");h(this,"keys");h(this,"nodeFunc");h(this,"nodess");h(this,"depNum");this.array=[...e],this.nodeFunc=t,this.keys=n,this.depNum=i,this.nodess=this.array.map(o=>t(o)),this._$nodes=this.nodess.flat(1)}update(e){if(!(e&this.depNum))for(let t=0;t<this.array.length;t++)this.updateItem(this.nodess[t],this.array[t],e)}updateItem(e,t,i){var n,o;(o=(n=e[0])._$updateFunc)==null||o.call(n,i??this.depNum,t)}updateArray(e,t){if(t){this.updateWithKey(e,t);return}this.updateWithOutKey(e)}getNewNodes(e){return this.geneNewNodesInEnv(()=>this.nodeFunc(this.array[e]))}updateWithOutKey(e){let t=this.array.length,i=e.length;if(this.array=[...e],t===i){for(let o=0;o<this.array.length;o++)this.updateItem(this.nodess[o],this.array[o]);return}let n=this._$parentEl;if(t<i){let o=w.getFlowIndexFromNodes(n._$nodes,this),u=n.childNodes.length;for(let f=0;f<i;f++){if(f<t){o+=w.getFlowIndexFromNodes(this.nodess[f]),this.updateItem(this.nodess[f],this.array[f]);continue}let c=this.getNewNodes(f);w.appendNodesWithIndex(c,n,o,u),this.nodess.push(c)}this._$nodes=this.nodess.flat(1);return}for(let o=0;o<i;o++)this.updateItem(this.nodess[o],this.array[o]);for(let o=i;o<t;o++)this.removeNodes(this.nodess[o]);this.nodess=this.nodess.slice(0,i),this._$nodes=this.nodess.flat(1)}updateWithKey(e,t){let i=this.keys,n=this.array;if(this.array=[...e],this.keys=t,P.arrayEqual(i,this.keys)){for(let d=0;d<this.array.length;d++)this.updateItem(this.nodess[d],this.array[d]);return}let o=this._$parentEl,u=this.nodess;if(this.keys.length===0){let d=o._$nodes??[];if(d.length===1&&d[0]===this)o.innerHTML="";else for(let $=0;$<i.length;$++)this.removeNodes(u[$]);this.nodess=[],this._$nodes=[];return}let f=w.getFlowIndexFromNodes(o._$nodes,this);if(i.length===0){let d=o.childNodes[f];for(let $=0;$<this.keys.length;$++){let g=this.getNewNodes($);w.appendNodesWithSibling(g,o,d),this.nodess.push(g)}this._$nodes=this.nodess.flat(1);return}let c=[],a=[],m=[];for(let d=0;d<i.length;d++){let $=i[d];if(this.keys.includes($)){c.push($),a.push(u[d]),m.push(n[d]);continue}this.removeNodes(u[d])}let p=o.childNodes.length,r=f;for(let d=0;d<this.keys.length;d++){let $=this.keys[d],g=c.indexOf($);if(g!==-1){r+=w.getFlowIndexFromNodes(a[g]),this.updateItem(a[g],this.array[d]);continue}let v=this.getNewNodes(d),x=w.appendNodesWithIndex(v,o,r,p);r+=x,p+=x,a.splice(d,0,v),c.splice(d,0,$)}if(P.arrayEqual(this.keys,c)){this.nodess=a,this._$nodes=this.nodess.flat(1);return}r=f;let l=[];for(let d=0;d<this.keys.length;d++){let $=this.keys[d],g=c.indexOf($),v=l[d];if(v){let y=w.appendNodesWithIndex(v,o,r+w.getFlowIndexFromNodes(v),p);r+=y,p+=y,l[d]=void 0}else if(g===d){r+=w.getFlowIndexFromNodes(a[d]);continue}else{l[this.keys.indexOf(c[d])]=a[d];let y=w.appendNodesWithIndex(a[g],o,r,p);r+=y,p+=y}let x=a[d];a[d]=a[g],a[g]=x;let b=c[d];c[d]=c[g],c[g]=b}this.nodess=a,this._$nodes=this.nodess.flat(1)}static arrayEqual(e,t){return e.length!==t.length?!1:e.every((i,n)=>i===t[n])}},L=class extends w{constructor(e,t){super(2);h(this,"condFunc");h(this,"cond");h(this,"depNum");this.condFunc=e,this.depNum=t,this.cond=-1,this._$nodes=this.condFunc(this)}updateCond(){let e=this.geneNewNodesInEnv(()=>this.condFunc(this));if(this.didntChange)return this.didntChange=!1,this.updateChildren();if(this._$nodes&&this._$nodes.length>0&&this.removeNodes(this._$nodes),this.cond===-1){this._$nodes=[];return}let t=this._$parentEl,i=w.getFlowIndexFromNodes(t._$nodes,this),n=t.childNodes[i];w.appendNodesWithSibling(e,t,n),this._$nodes=e}updateChildren(e){var t,i;(i=(t=this._$nodes[0])==null?void 0:t._$updateFunc)==null||i.call(t,e??this.depNum)}update(e){e&this.depNum||this.updateChildren(e)}},q=class{constructor(){h(this,"envs",{});h(this,"currentEnvNodes",[])}addEnvNode(s){this.currentEnvNodes.push(s),this.mergeEnvs()}replaceEnvNodes(s){this.currentEnvNodes=s,this.mergeEnvs()}removeEnvNode(){this.currentEnvNodes.pop(),this.mergeEnvs()}mergeEnvs(){this.envs={},this.currentEnvNodes.forEach(s=>{Object.entries(s.envs).forEach(([e,t])=>{this.envs[e]=[t,s]})})}};window.DLEnvStore||(window.DLEnvStore=new q);function J(s){return document.createTextNode(s)}function R(s,e){s.textContent!==e&&(s.textContent=e)}function z(s,e){let t=s;if(typeof s=="string"){let n=document.getElementById(s);if(n)t=n;else throw new Error(`DLight: Element with id ${s} not found`)}t.innerHTML="";let i=new e;T(t,i,0)}const _=class _ extends K{constructor(t,i,n,o){super();h(this,"$todos",[]);h(this,"$$todos",1);h(this,"$s$todos",["remainingCount","filteredTodos"]);h(this,"$editingId",null);h(this,"$$editingId",2);h(this,"$editingText","");h(this,"$$editingText",4);h(this,"$remainingCount");h(this,"$$remainingCount",8);h(this,"$showMode",location.hash.slice(2)||"all");h(this,"$$showMode",16);h(this,"$s$showMode",["filteredTodos"]);h(this,"$filteredTodos");h(this,"$$filteredTodos",32);this.addTodo=this.addTodo.bind(this),this.removeTodo=this.removeTodo.bind(this),this.toggleTodo=this.toggleTodo.bind(this),this.doneEditing=this.doneEditing.bind(this),this.clearCompleted=this.clearCompleted.bind(this),this.locationHandler=this.locationHandler.bind(this),this.willMount=this.willMount.bind(this),this.didUnmount=this.didUnmount.bind(this),this._$init(t,i,n,o)}get todos(){return this.$todos}set todos(t){this._$updateProp("todos",t)}get editingId(){return this.$editingId}set editingId(t){this._$updateProp("editingId",t)}get editingText(){return this.$editingText}set editingText(t){this._$updateProp("editingText",t)}get remainingCount(){return this.$remainingCount}set remainingCount(t){this._$updateProp("remainingCount",t)}get $f$remainingCount(){return this.todos.filter(t=>!t.completed).length}get showMode(){return this.$showMode}set showMode(t){this._$updateProp("showMode",t)}get filteredTodos(){return this.$filteredTodos}set filteredTodos(t){this._$updateProp("filteredTodos",t)}get $f$filteredTodos(){return this.todos.filter(t=>{switch(this.showMode){case"active":return!t.completed;case"completed":return t.completed;default:return!0}})}addTodo({target:t,key:i}){const n=t.value.trim();i==="Enter"&&n&&(this.todos=[...this.todos,{id:performance.now(),title:n,completed:!1}],console.log(this.todos),t.value="")}removeTodo(t){this.todos=this.todos.filter(i=>i.id!==t)}toggleTodo(t){this.todos=this.todos.map(i=>i.id===t?{...i,completed:!i.completed}:i)}doneEditing(t){this.todos=this.todos.map(i=>i.id===t?{...i,title:this.editingText}:i),this.editingId=null}clearCompleted(){this.todos=this.todos.filter(t=>!t.completed)}locationHandler(){this.showMode=location.hash.slice(2)||"all"}willMount(){window.addEventListener("hashchange",this.locationHandler)}didUnmount(){window.removeEventListener("hashchange",this.locationHandler)}ToDoItem({id:t,title:i,completed:n,editing:o}){const u=_.$t2(),f=u.firstChild,c=f.firstChild,a=f.firstChild.nextSibling,m=f.firstChild.nextSibling.nextSibling;u.className=`todo ${o?"editing":""} ${n?"completed":""}`.trim(),c.addEventListener("input",()=>this.toggleTodo(t)),c.checked=n,a.addEventListener("dblclick",()=>{this.editingText=i,this.editingId=t}),a.textContent=i,m.addEventListener("click",()=>{this.removeTodo(t)});const p=new L(r=>{if(o){if(r.cond===0)return r.didntChange=!0,[];const l=O("input");return(d=>{setTimeout(()=>d.focus())})(l),l.addEventListener("blur",()=>this.doneEditing(t)),l.addEventListener("input",d=>{this.editingText=d.target.value}),N(l,"value",this.editingText),l.className="edit",l._$updateFunc=d=>{d&4&&N(l,"value",this.editingText)},r.cond=0,[l]}else return r.cond=-1,[]},0);return T(u,p,1),{_$dlNodeType:5,update:r=>{p.update(r)},updateProp:(r,l)=>{r&1&&({id:t}=l,C(c,"input",()=>this.toggleTodo(t)),C(m,"click",()=>{this.removeTodo(t)})),r&2&&({title:i}=l,N(a,"textContent",i)),r&3&&C(a,"dblclick",()=>{this.editingText=i,this.editingId=t}),r&4&&({completed:n}=l,N(c,"checked",n)),r&8&&({editing:o}=l,p.updateCond()),r&12&&N(u,"className",`todo ${o?"editing":""} ${n?"completed":""}`.trim())},_$nodes:[u]}}Footer(){const t=_.$t3(),i=t.firstChild,n=i.nextSibling,o=i.firstChild,u=n.firstChild.firstChild,f=n.firstChild.nextSibling.firstChild,c=n.firstChild.nextSibling.nextSibling.firstChild;N(o,"textContent",this.remainingCount),N(u,"className",this.showMode==="all"?"selected":""),N(f,"className",this.showMode==="active"?"selected":""),N(c,"className",this.showMode==="completed"?"selected":"");const a=new L(p=>{if(this.remainingCount!==this.todos.length){if(p.cond===0)return p.didntChange=!0,[];const r=O("button");return r.addEventListener("click",this.clearCompleted),r.className="clear-completed",r.textContent="Clear completed",p.cond=0,[r]}else return p.cond=-1,[]},9);T(t,a,2);const m=J(` ${this.remainingCount>1?"items":"item"} left`);return T(i,m,1),{_$dlNodeType:5,update:p=>{p&9&&(N(o,"textContent",this.remainingCount),a.updateCond(),R(m,` ${this.remainingCount>1?"items":"item"} left`)),p&16&&(N(u,"className",this.showMode==="all"?"selected":""),N(f,"className",this.showMode==="active"?"selected":""),N(c,"className",this.showMode==="completed"?"selected":"")),a.update(p)},_$nodes:[t]}}View(){const t=_.$t0();t.firstChild.firstChild.nextSibling.addEventListener("keydown",this.addTodo);const n=new L(o=>{if(this.todos.length>0){if(o.cond===0)return o.didntChange=!0,[];const u=_.$t1(),f=u.firstChild.nextSibling.nextSibling,c=new P(this.filteredTodos,({id:m,title:p,completed:r})=>{const l=this.ToDoItem({editing:this.editingId===m,completed:r,title:p,id:m});return l._$updateFunc=(d,{id:$,title:g,completed:v})=>{var x,b,y,S;d&2&&((x=l.updateProp)==null||x.call(l,8,{editing:this.editingId===$})),d&49&&((b=l.updateProp)==null||b.call(l,4,{completed:v}),(y=l.updateProp)==null||y.call(l,2,{title:g})),(S=l.update)==null||S.call(l,d)},[l]},49,this.filteredTodos.map(({id:m,title:p,completed:r})=>m));T(f,c,0);const a=this.Footer({});return u._$updateFunc=m=>{var p;m&49&&c.updateArray(this.filteredTodos,this.filteredTodos.map(({id:r,title:l,completed:d})=>r)),c.update(m),(p=a.update)==null||p.call(a,m)},o.cond=0,[u,a]}else return o.cond=-1,[]},1);return T(t,n,1),this._$update=o=>{o&1&&n.updateCond(),n.update(o)},[t]}};h(_,"$t0",I('<section class="todoapp"><header class="header"><h1>todos</h1><input autofocus placeholder="What needs to be done?" class="new-todo"></input></header></section>')),h(_,"$t1",I('<section class="main"><input type="checkbox" class="toggle-all" id="toggle-all"></input><label for="toggle-all"></label><ul class="todo-list"></ul></section>')),h(_,"$t2",I('<li><div class="view"><input type="checkbox" class="toggle"></input><label></label><button class="destroy"></button></div></li>')),h(_,"$t3",I('<footer class="footer"><span class="todo-count"><strong></strong></span><ul class="filters"><li><a href="#/">All</a></li><li><a href="#/active">Active</a></li><li><a href="#/completed">Completed</a></li></ul></footer>'));let F=_;z("app",F);
